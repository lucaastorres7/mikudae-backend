generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ------ Mobshow Tables ------
model MobSession {
  id            Int       @id @default(autoincrement())
  serverId      String
  channelId     String
  hostId        String
  status        MobStatus @default(WAITING)
  participants  MobParticipant[]
  winner        String?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model MobParticipant {
  id            Int       @id @default(autoincrement())
  sessionId     Int
  playerId      String
  score         Int       @default(0)

  session       MobSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, playerId])
}

// ------ Gacha Tables ------
model Player {
  id              String    @id
  rollsCount      Int       @default(0)
  lastInteraction DateTime  @default(now())

  harems          Harem[]
}

model Character {
  id           Int      @id @default(autoincrement())
  name         String
  gender       Gender
  category     Category
  images       String[]
  kakeraValue  Int
  
  series       CharactersOnSeries[]
  owners       CharacterOwnership[]
}

model Serie {
  id       Int @id @default(autoincrement())
  name     String
  image    String?
  
  characters CharactersOnSeries[]
}

model Harem {
  id          Int      @id @default(autoincrement())
  name        String
  ownerId     String
  serverId    String

  owner       Player   @relation(fields: [ownerId], references: [id])
  characters  CharacterOwnership[]

  @@unique([ownerId, serverId])
}

model ServerConfig {
  serverId   String   @id
  gameMode   GameMode @default(MODE_1)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// ------ Join Tables ------
model CharactersOnSeries {
  characterId Int
  serieId     Int

  character   Character @relation(fields: [characterId], references: [id])
  serie       Serie     @relation(fields: [serieId], references: [id])

  @@id([characterId, serieId])
}

model CharacterOwnership {
  id          Int      @id @default(autoincrement())
  haremId     Int
  characterId Int

  harem       Harem    @relation(fields: [haremId], references: [id])
  character   Character @relation(fields: [characterId], references: [id])

  @@unique([haremId, characterId])
}

// ------ Enums ------
enum Category {
  ANIME
  GAME
  BOTH
}

enum Gender {
  WAIFU
  HUSBANDO
  BOTH
}

enum GameMode {
  MODE_1
  MODE_2
}

enum MobStatus {
  ACTIVE
  WAITING
  FINISHED
}